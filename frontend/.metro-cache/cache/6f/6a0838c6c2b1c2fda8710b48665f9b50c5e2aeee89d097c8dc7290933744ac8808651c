{"dependencies":[{"name":"./cell","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":13,"index":28},"end":{"line":3,"column":30,"index":45}}],"key":"mifHiTlApgxoQiQUYXLQBwQ35T4=","exportNames":["*"],"imports":1}},{"name":"./pledge","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":13,"index":60},"end":{"line":4,"column":32,"index":79}}],"key":"HRuaX7zGAi9jJ3MeVRBZAhvoGMQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var Cell = require(_dependencyMap[0], \"./cell\"),\n    Pledge = require(_dependencyMap[1], \"./pledge\");\n  var Pipeline = function (sessions) {\n    this._cells = sessions.map(function (session) {\n      return new Cell(session);\n    });\n    this._stopped = {\n      incoming: false,\n      outgoing: false\n    };\n  };\n  Pipeline.prototype.processIncomingMessage = function (message, callback, context) {\n    if (this._stopped.incoming) return;\n    this._loop('incoming', this._cells.length - 1, -1, -1, message, callback, context);\n  };\n  Pipeline.prototype.processOutgoingMessage = function (message, callback, context) {\n    if (this._stopped.outgoing) return;\n    this._loop('outgoing', 0, this._cells.length, 1, message, callback, context);\n  };\n  Pipeline.prototype.close = function (callback, context) {\n    this._stopped = {\n      incoming: true,\n      outgoing: true\n    };\n    var closed = this._cells.map(function (a) {\n      return a.close();\n    });\n    if (callback) Pledge.all(closed).then(function () {\n      callback.call(context);\n    });\n  };\n  Pipeline.prototype._loop = function (direction, start, end, step, message, callback, context) {\n    var cells = this._cells,\n      n = cells.length,\n      self = this;\n    while (n--) cells[n].pending(direction);\n    var pipe = function (index, error, msg) {\n      if (index === end) return callback.call(context, error, msg);\n      cells[index][direction](error, msg, function (err, m) {\n        if (err) self._stopped[direction] = true;\n        pipe(index + step, err, m);\n      });\n    };\n    pipe(start, null, message);\n  };\n  module.exports = Pipeline;\n});","lineCount":50,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"Cell"],[4,10,3,8],[4,13,3,13,"require"],[4,20,3,20],[4,21,3,20,"_dependencyMap"],[4,35,3,20],[4,48,3,29],[4,49,3,30],[5,4,4,4,"Pledge"],[5,10,4,10],[5,13,4,13,"require"],[5,20,4,20],[5,21,4,20,"_dependencyMap"],[5,35,4,20],[5,50,4,31],[5,51,4,32],[6,2,6,0],[6,6,6,4,"Pipeline"],[6,14,6,12],[6,17,6,15],[6,26,6,15,"Pipeline"],[6,27,6,24,"sessions"],[6,35,6,32],[6,37,6,34],[7,4,7,2],[7,8,7,6],[7,9,7,7,"_cells"],[7,15,7,13],[7,18,7,18,"sessions"],[7,26,7,26],[7,27,7,27,"map"],[7,30,7,30],[7,31,7,31],[7,41,7,40,"session"],[7,48,7,47],[7,50,7,49],[8,6,7,51],[8,13,7,58],[8,17,7,62,"Cell"],[8,21,7,66],[8,22,7,67,"session"],[8,29,7,74],[8,30,7,75],[9,4,7,76],[9,5,7,77],[9,6,7,78],[10,4,8,2],[10,8,8,6],[10,9,8,7,"_stopped"],[10,17,8,15],[10,20,8,18],[11,6,8,20,"incoming"],[11,14,8,28],[11,16,8,30],[11,21,8,35],[12,6,8,37,"outgoing"],[12,14,8,45],[12,16,8,47],[13,4,8,53],[13,5,8,54],[14,2,9,0],[14,3,9,1],[15,2,11,0,"Pipeline"],[15,10,11,8],[15,11,11,9,"prototype"],[15,20,11,18],[15,21,11,19,"processIncomingMessage"],[15,43,11,41],[15,46,11,44],[15,56,11,53,"message"],[15,63,11,60],[15,65,11,62,"callback"],[15,73,11,70],[15,75,11,72,"context"],[15,82,11,79],[15,84,11,81],[16,4,12,2],[16,8,12,6],[16,12,12,10],[16,13,12,11,"_stopped"],[16,21,12,19],[16,22,12,20,"incoming"],[16,30,12,28],[16,32,12,30],[17,4,13,2],[17,8,13,6],[17,9,13,7,"_loop"],[17,14,13,12],[17,15,13,13],[17,25,13,23],[17,27,13,25],[17,31,13,29],[17,32,13,30,"_cells"],[17,38,13,36],[17,39,13,37,"length"],[17,45,13,43],[17,48,13,46],[17,49,13,47],[17,51,13,49],[17,52,13,50],[17,53,13,51],[17,55,13,53],[17,56,13,54],[17,57,13,55],[17,59,13,57,"message"],[17,66,13,64],[17,68,13,66,"callback"],[17,76,13,74],[17,78,13,76,"context"],[17,85,13,83],[17,86,13,84],[18,2,14,0],[18,3,14,1],[19,2,16,0,"Pipeline"],[19,10,16,8],[19,11,16,9,"prototype"],[19,20,16,18],[19,21,16,19,"processOutgoingMessage"],[19,43,16,41],[19,46,16,44],[19,56,16,53,"message"],[19,63,16,60],[19,65,16,62,"callback"],[19,73,16,70],[19,75,16,72,"context"],[19,82,16,79],[19,84,16,81],[20,4,17,2],[20,8,17,6],[20,12,17,10],[20,13,17,11,"_stopped"],[20,21,17,19],[20,22,17,20,"outgoing"],[20,30,17,28],[20,32,17,30],[21,4,18,2],[21,8,18,6],[21,9,18,7,"_loop"],[21,14,18,12],[21,15,18,13],[21,25,18,23],[21,27,18,25],[21,28,18,26],[21,30,18,28],[21,34,18,32],[21,35,18,33,"_cells"],[21,41,18,39],[21,42,18,40,"length"],[21,48,18,46],[21,50,18,48],[21,51,18,49],[21,53,18,51,"message"],[21,60,18,58],[21,62,18,60,"callback"],[21,70,18,68],[21,72,18,70,"context"],[21,79,18,77],[21,80,18,78],[22,2,19,0],[22,3,19,1],[23,2,21,0,"Pipeline"],[23,10,21,8],[23,11,21,9,"prototype"],[23,20,21,18],[23,21,21,19,"close"],[23,26,21,24],[23,29,21,27],[23,39,21,36,"callback"],[23,47,21,44],[23,49,21,46,"context"],[23,56,21,53],[23,58,21,55],[24,4,22,2],[24,8,22,6],[24,9,22,7,"_stopped"],[24,17,22,15],[24,20,22,18],[25,6,22,20,"incoming"],[25,14,22,28],[25,16,22,30],[25,20,22,34],[26,6,22,36,"outgoing"],[26,14,22,44],[26,16,22,46],[27,4,22,51],[27,5,22,52],[28,4,24,2],[28,8,24,6,"closed"],[28,14,24,12],[28,17,24,15],[28,21,24,19],[28,22,24,20,"_cells"],[28,28,24,26],[28,29,24,27,"map"],[28,32,24,30],[28,33,24,31],[28,43,24,40,"a"],[28,44,24,41],[28,46,24,43],[29,6,24,45],[29,13,24,52,"a"],[29,14,24,53],[29,15,24,54,"close"],[29,20,24,59],[29,21,24,60],[29,22,24,61],[30,4,24,62],[30,5,24,63],[30,6,24,64],[31,4,25,2],[31,8,25,6,"callback"],[31,16,25,14],[31,18,26,4,"Pledge"],[31,24,26,10],[31,25,26,11,"all"],[31,28,26,14],[31,29,26,15,"closed"],[31,35,26,21],[31,36,26,22],[31,37,26,23,"then"],[31,41,26,27],[31,42,26,28],[31,54,26,39],[32,6,26,41,"callback"],[32,14,26,49],[32,15,26,50,"call"],[32,19,26,54],[32,20,26,55,"context"],[32,27,26,62],[32,28,26,63],[33,4,26,64],[33,5,26,65],[33,6,26,66],[34,2,27,0],[34,3,27,1],[35,2,29,0,"Pipeline"],[35,10,29,8],[35,11,29,9,"prototype"],[35,20,29,18],[35,21,29,19,"_loop"],[35,26,29,24],[35,29,29,27],[35,39,29,36,"direction"],[35,48,29,45],[35,50,29,47,"start"],[35,55,29,52],[35,57,29,54,"end"],[35,60,29,57],[35,62,29,59,"step"],[35,66,29,63],[35,68,29,65,"message"],[35,75,29,72],[35,77,29,74,"callback"],[35,85,29,82],[35,87,29,84,"context"],[35,94,29,91],[35,96,29,93],[36,4,30,2],[36,8,30,6,"cells"],[36,13,30,11],[36,16,30,14],[36,20,30,18],[36,21,30,19,"_cells"],[36,27,30,25],[37,6,31,6,"n"],[37,7,31,7],[37,10,31,14,"cells"],[37,15,31,19],[37,16,31,20,"length"],[37,22,31,26],[38,6,32,6,"self"],[38,10,32,10],[38,13,32,14],[38,17,32,18],[39,4,34,2],[39,11,34,9,"n"],[39,12,34,10],[39,14,34,12],[39,16,34,14,"cells"],[39,21,34,19],[39,22,34,20,"n"],[39,23,34,21],[39,24,34,22],[39,25,34,23,"pending"],[39,32,34,30],[39,33,34,31,"direction"],[39,42,34,40],[39,43,34,41],[40,4,36,2],[40,8,36,6,"pipe"],[40,12,36,10],[40,15,36,13],[40,24,36,13,"pipe"],[40,25,36,22,"index"],[40,30,36,27],[40,32,36,29,"error"],[40,37,36,34],[40,39,36,36,"msg"],[40,42,36,39],[40,44,36,41],[41,6,37,4],[41,10,37,8,"index"],[41,15,37,13],[41,20,37,18,"end"],[41,23,37,21],[41,25,37,23],[41,32,37,30,"callback"],[41,40,37,38],[41,41,37,39,"call"],[41,45,37,43],[41,46,37,44,"context"],[41,53,37,51],[41,55,37,53,"error"],[41,60,37,58],[41,62,37,60,"msg"],[41,65,37,63],[41,66,37,64],[42,6,39,4,"cells"],[42,11,39,9],[42,12,39,10,"index"],[42,17,39,15],[42,18,39,16],[42,19,39,17,"direction"],[42,28,39,26],[42,29,39,27],[42,30,39,28,"error"],[42,35,39,33],[42,37,39,35,"msg"],[42,40,39,38],[42,42,39,40],[42,52,39,49,"err"],[42,55,39,52],[42,57,39,54,"m"],[42,58,39,55],[42,60,39,57],[43,8,40,6],[43,12,40,10,"err"],[43,15,40,13],[43,17,40,15,"self"],[43,21,40,19],[43,22,40,20,"_stopped"],[43,30,40,28],[43,31,40,29,"direction"],[43,40,40,38],[43,41,40,39],[43,44,40,42],[43,48,40,46],[44,8,41,6,"pipe"],[44,12,41,10],[44,13,41,11,"index"],[44,18,41,16],[44,21,41,19,"step"],[44,25,41,23],[44,27,41,25,"err"],[44,30,41,28],[44,32,41,30,"m"],[44,33,41,31],[44,34,41,32],[45,6,42,4],[45,7,42,5],[45,8,42,6],[46,4,43,2],[46,5,43,3],[47,4,44,2,"pipe"],[47,8,44,6],[47,9,44,7,"start"],[47,14,44,12],[47,16,44,14],[47,20,44,18],[47,22,44,20,"message"],[47,29,44,27],[47,30,44,28],[48,2,45,0],[48,3,45,1],[49,2,47,0,"module"],[49,8,47,6],[49,9,47,7,"exports"],[49,16,47,14],[49,19,47,17,"Pipeline"],[49,27,47,25],[50,0,47,26],[50,3]],"functionMap":{"names":["<global>","Pipeline","sessions.map$argument_0","Pipeline.prototype.processIncomingMessage","Pipeline.prototype.processOutgoingMessage","Pipeline.prototype.close","_cells.map$argument_0","Pledge.all.then$argument_0","Pipeline.prototype._loop","pipe","cells.index.direction$argument_2"],"mappings":"AAA;eCK;+BCC,8CD;CDE;4CGE;CHG;4CIE;CJG;2BKE;+BCG,gCD;4BEE,qCF;CLC;2BQE;aCO;wCCG;KDG;GDC;CRE"},"hasCjsExports":true},"type":"js/module"}]}