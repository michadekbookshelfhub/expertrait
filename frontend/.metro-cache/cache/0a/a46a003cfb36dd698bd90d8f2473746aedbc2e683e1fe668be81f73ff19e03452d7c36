{"dependencies":[{"name":"safe-buffer","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":13,"index":28},"end":{"line":3,"column":35,"index":50}}],"key":"JYiVyKV2adrbhzv3Ouecl8p4NAI=","exportNames":["*"],"imports":1}},{"name":"./base","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":13,"index":72},"end":{"line":4,"column":30,"index":89}}],"key":"cAa/j2PXTeXj4b1JbTLYHmmEU2Q=","exportNames":["*"],"imports":1}},{"name":"util","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":13,"index":104},"end":{"line":5,"column":28,"index":119}}],"key":"plO20G0zye191TqKMAMeOagk9EI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var Buffer = require(_dependencyMap[0], \"safe-buffer\").Buffer,\n    Base = require(_dependencyMap[1], \"./base\"),\n    util = require(_dependencyMap[2], \"util\");\n  var Draft75 = function (request, url, options) {\n    Base.apply(this, arguments);\n    this._stage = 0;\n    this.version = 'hixie-75';\n    this._headers.set('Upgrade', 'WebSocket');\n    this._headers.set('Connection', 'Upgrade');\n    this._headers.set('WebSocket-Origin', this._request.headers.origin);\n    this._headers.set('WebSocket-Location', this.url);\n  };\n  util.inherits(Draft75, Base);\n  var instance = {\n    close: function () {\n      if (this.readyState === 3) return false;\n      this.readyState = 3;\n      this.emit('close', new Base.CloseEvent(null, null));\n      return true;\n    },\n    parse: function (chunk) {\n      if (this.readyState > 1) return;\n      this._reader.put(chunk);\n      this._reader.eachByte(function (octet) {\n        var message;\n        switch (this._stage) {\n          case -1:\n            this._body.push(octet);\n            this._sendHandshakeBody();\n            break;\n          case 0:\n            this._parseLeadingByte(octet);\n            break;\n          case 1:\n            this._length = (octet & 0x7F) + 128 * this._length;\n            if (this._closing && this._length === 0) {\n              return this.close();\n            } else if ((octet & 0x80) !== 0x80) {\n              if (this._length === 0) {\n                this._stage = 0;\n              } else {\n                this._skipped = 0;\n                this._stage = 2;\n              }\n            }\n            break;\n          case 2:\n            if (octet === 0xFF) {\n              this._stage = 0;\n              message = Buffer.from(this._buffer).toString('utf8', 0, this._buffer.length);\n              this.emit('message', new Base.MessageEvent(message));\n            } else {\n              if (this._length) {\n                this._skipped += 1;\n                if (this._skipped === this._length) this._stage = 0;\n              } else {\n                this._buffer.push(octet);\n                if (this._buffer.length > this._maxLength) return this.close();\n              }\n            }\n            break;\n        }\n      }, this);\n    },\n    frame: function (buffer) {\n      if (this.readyState === 0) return this._queue([buffer]);\n      if (this.readyState > 1) return false;\n      if (typeof buffer !== 'string') buffer = buffer.toString();\n      var length = Buffer.byteLength(buffer),\n        frame = Buffer.allocUnsafe(length + 2);\n      frame[0] = 0x00;\n      frame.write(buffer, 1);\n      frame[frame.length - 1] = 0xFF;\n      this._write(frame);\n      return true;\n    },\n    _handshakeResponse: function () {\n      var start = 'HTTP/1.1 101 Web Socket Protocol Handshake',\n        headers = [start, this._headers.toString(), ''];\n      return Buffer.from(headers.join('\\r\\n'), 'utf8');\n    },\n    _parseLeadingByte: function (octet) {\n      if ((octet & 0x80) === 0x80) {\n        this._length = 0;\n        this._stage = 1;\n      } else {\n        delete this._length;\n        delete this._skipped;\n        this._buffer = [];\n        this._stage = 2;\n      }\n    }\n  };\n  for (var key in instance) Draft75.prototype[key] = instance[key];\n  module.exports = Draft75;\n});","lineCount":99,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"Buffer"],[4,12,3,10],[4,15,3,13,"require"],[4,22,3,20],[4,23,3,20,"_dependencyMap"],[4,37,3,20],[4,55,3,34],[4,56,3,35],[4,57,3,36,"Buffer"],[4,63,3,42],[5,4,4,4,"Base"],[5,8,4,8],[5,11,4,13,"require"],[5,18,4,20],[5,19,4,20,"_dependencyMap"],[5,33,4,20],[5,46,4,29],[5,47,4,30],[6,4,5,4,"util"],[6,8,5,8],[6,11,5,13,"require"],[6,18,5,20],[6,19,5,20,"_dependencyMap"],[6,33,5,20],[6,44,5,27],[6,45,5,28],[7,2,7,0],[7,6,7,4,"Draft75"],[7,13,7,11],[7,16,7,14],[7,25,7,14,"Draft75"],[7,26,7,23,"request"],[7,33,7,30],[7,35,7,32,"url"],[7,38,7,35],[7,40,7,37,"options"],[7,47,7,44],[7,49,7,46],[8,4,8,2,"Base"],[8,8,8,6],[8,9,8,7,"apply"],[8,14,8,12],[8,15,8,13],[8,19,8,17],[8,21,8,19,"arguments"],[8,30,8,28],[8,31,8,29],[9,4,9,2],[9,8,9,6],[9,9,9,7,"_stage"],[9,15,9,13],[9,18,9,17],[9,19,9,18],[10,4,10,2],[10,8,10,6],[10,9,10,7,"version"],[10,16,10,14],[10,19,10,17],[10,29,10,27],[11,4,12,2],[11,8,12,6],[11,9,12,7,"_headers"],[11,17,12,15],[11,18,12,16,"set"],[11,21,12,19],[11,22,12,20],[11,31,12,29],[11,33,12,31],[11,44,12,42],[11,45,12,43],[12,4,13,2],[12,8,13,6],[12,9,13,7,"_headers"],[12,17,13,15],[12,18,13,16,"set"],[12,21,13,19],[12,22,13,20],[12,34,13,32],[12,36,13,34],[12,45,13,43],[12,46,13,44],[13,4,14,2],[13,8,14,6],[13,9,14,7,"_headers"],[13,17,14,15],[13,18,14,16,"set"],[13,21,14,19],[13,22,14,20],[13,40,14,38],[13,42,14,40],[13,46,14,44],[13,47,14,45,"_request"],[13,55,14,53],[13,56,14,54,"headers"],[13,63,14,61],[13,64,14,62,"origin"],[13,70,14,68],[13,71,14,69],[14,4,15,2],[14,8,15,6],[14,9,15,7,"_headers"],[14,17,15,15],[14,18,15,16,"set"],[14,21,15,19],[14,22,15,20],[14,42,15,40],[14,44,15,42],[14,48,15,46],[14,49,15,47,"url"],[14,52,15,50],[14,53,15,51],[15,2,16,0],[15,3,16,1],[16,2,17,0,"util"],[16,6,17,4],[16,7,17,5,"inherits"],[16,15,17,13],[16,16,17,14,"Draft75"],[16,23,17,21],[16,25,17,23,"Base"],[16,29,17,27],[16,30,17,28],[17,2,19,0],[17,6,19,4,"instance"],[17,14,19,12],[17,17,19,15],[18,4,20,2,"close"],[18,9,20,7],[18,11,20,9],[18,20,20,9,"close"],[18,21,20,9],[18,23,20,20],[19,6,21,4],[19,10,21,8],[19,14,21,12],[19,15,21,13,"readyState"],[19,25,21,23],[19,30,21,28],[19,31,21,29],[19,33,21,31],[19,40,21,38],[19,45,21,43],[20,6,22,4],[20,10,22,8],[20,11,22,9,"readyState"],[20,21,22,19],[20,24,22,22],[20,25,22,23],[21,6,23,4],[21,10,23,8],[21,11,23,9,"emit"],[21,15,23,13],[21,16,23,14],[21,23,23,21],[21,25,23,23],[21,29,23,27,"Base"],[21,33,23,31],[21,34,23,32,"CloseEvent"],[21,44,23,42],[21,45,23,43],[21,49,23,47],[21,51,23,49],[21,55,23,53],[21,56,23,54],[21,57,23,55],[22,6,24,4],[22,13,24,11],[22,17,24,15],[23,4,25,2],[23,5,25,3],[24,4,27,2,"parse"],[24,9,27,7],[24,11,27,9],[24,20,27,9,"parse"],[24,21,27,18,"chunk"],[24,26,27,23],[24,28,27,25],[25,6,28,4],[25,10,28,8],[25,14,28,12],[25,15,28,13,"readyState"],[25,25,28,23],[25,28,28,26],[25,29,28,27],[25,31,28,29],[26,6,30,4],[26,10,30,8],[26,11,30,9,"_reader"],[26,18,30,16],[26,19,30,17,"put"],[26,22,30,20],[26,23,30,21,"chunk"],[26,28,30,26],[26,29,30,27],[27,6,32,4],[27,10,32,8],[27,11,32,9,"_reader"],[27,18,32,16],[27,19,32,17,"eachByte"],[27,27,32,25],[27,28,32,26],[27,38,32,35,"octet"],[27,43,32,40],[27,45,32,42],[28,8,33,6],[28,12,33,10,"message"],[28,19,33,17],[29,8,35,6],[29,16,35,14],[29,20,35,18],[29,21,35,19,"_stage"],[29,27,35,25],[30,10,36,8],[30,15,36,13],[30,16,36,14],[30,17,36,15],[31,12,37,10],[31,16,37,14],[31,17,37,15,"_body"],[31,22,37,20],[31,23,37,21,"push"],[31,27,37,25],[31,28,37,26,"octet"],[31,33,37,31],[31,34,37,32],[32,12,38,10],[32,16,38,14],[32,17,38,15,"_sendHandshakeBody"],[32,35,38,33],[32,36,38,34],[32,37,38,35],[33,12,39,10],[34,10,41,8],[34,15,41,13],[34,16,41,14],[35,12,42,10],[35,16,42,14],[35,17,42,15,"_parseLeadingByte"],[35,34,42,32],[35,35,42,33,"octet"],[35,40,42,38],[35,41,42,39],[36,12,43,10],[37,10,45,8],[37,15,45,13],[37,16,45,14],[38,12,46,10],[38,16,46,14],[38,17,46,15,"_length"],[38,24,46,22],[38,27,46,25],[38,28,46,26,"octet"],[38,33,46,31],[38,36,46,34],[38,40,46,38],[38,44,46,42],[38,47,46,45],[38,50,46,48],[38,54,46,52],[38,55,46,53,"_length"],[38,62,46,60],[39,12,48,10],[39,16,48,14],[39,20,48,18],[39,21,48,19,"_closing"],[39,29,48,27],[39,33,48,31],[39,37,48,35],[39,38,48,36,"_length"],[39,45,48,43],[39,50,48,48],[39,51,48,49],[39,53,48,51],[40,14,49,12],[40,21,49,19],[40,25,49,23],[40,26,49,24,"close"],[40,31,49,29],[40,32,49,30],[40,33,49,31],[41,12,50,10],[41,13,50,11],[41,19,51,15],[41,23,51,19],[41,24,51,20,"octet"],[41,29,51,25],[41,32,51,28],[41,36,51,32],[41,42,51,38],[41,46,51,42],[41,48,51,44],[42,14,52,12],[42,18,52,16],[42,22,52,20],[42,23,52,21,"_length"],[42,30,52,28],[42,35,52,33],[42,36,52,34],[42,38,52,36],[43,16,53,14],[43,20,53,18],[43,21,53,19,"_stage"],[43,27,53,25],[43,30,53,28],[43,31,53,29],[44,14,54,12],[44,15,54,13],[44,21,55,17],[45,16,56,14],[45,20,56,18],[45,21,56,19,"_skipped"],[45,29,56,27],[45,32,56,30],[45,33,56,31],[46,16,57,14],[46,20,57,18],[46,21,57,19,"_stage"],[46,27,57,25],[46,30,57,30],[46,31,57,31],[47,14,58,12],[48,12,59,10],[49,12,60,10],[50,10,62,8],[50,15,62,13],[50,16,62,14],[51,12,63,10],[51,16,63,14,"octet"],[51,21,63,19],[51,26,63,24],[51,30,63,28],[51,32,63,30],[52,14,64,12],[52,18,64,16],[52,19,64,17,"_stage"],[52,25,64,23],[52,28,64,26],[52,29,64,27],[53,14,65,12,"message"],[53,21,65,19],[53,24,65,22,"Buffer"],[53,30,65,28],[53,31,65,29,"from"],[53,35,65,33],[53,36,65,34],[53,40,65,38],[53,41,65,39,"_buffer"],[53,48,65,46],[53,49,65,47],[53,50,65,48,"toString"],[53,58,65,56],[53,59,65,57],[53,65,65,63],[53,67,65,65],[53,68,65,66],[53,70,65,68],[53,74,65,72],[53,75,65,73,"_buffer"],[53,82,65,80],[53,83,65,81,"length"],[53,89,65,87],[53,90,65,88],[54,14,66,12],[54,18,66,16],[54,19,66,17,"emit"],[54,23,66,21],[54,24,66,22],[54,33,66,31],[54,35,66,33],[54,39,66,37,"Base"],[54,43,66,41],[54,44,66,42,"MessageEvent"],[54,56,66,54],[54,57,66,55,"message"],[54,64,66,62],[54,65,66,63],[54,66,66,64],[55,12,67,10],[55,13,67,11],[55,19,68,15],[56,14,69,12],[56,18,69,16],[56,22,69,20],[56,23,69,21,"_length"],[56,30,69,28],[56,32,69,30],[57,16,70,14],[57,20,70,18],[57,21,70,19,"_skipped"],[57,29,70,27],[57,33,70,31],[57,34,70,32],[58,16,71,14],[58,20,71,18],[58,24,71,22],[58,25,71,23,"_skipped"],[58,33,71,31],[58,38,71,36],[58,42,71,40],[58,43,71,41,"_length"],[58,50,71,48],[58,52,72,16],[58,56,72,20],[58,57,72,21,"_stage"],[58,63,72,27],[58,66,72,30],[58,67,72,31],[59,14,73,12],[59,15,73,13],[59,21,73,19],[60,16,74,14],[60,20,74,18],[60,21,74,19,"_buffer"],[60,28,74,26],[60,29,74,27,"push"],[60,33,74,31],[60,34,74,32,"octet"],[60,39,74,37],[60,40,74,38],[61,16,75,14],[61,20,75,18],[61,24,75,22],[61,25,75,23,"_buffer"],[61,32,75,30],[61,33,75,31,"length"],[61,39,75,37],[61,42,75,40],[61,46,75,44],[61,47,75,45,"_maxLength"],[61,57,75,55],[61,59,75,57],[61,66,75,64],[61,70,75,68],[61,71,75,69,"close"],[61,76,75,74],[61,77,75,75],[61,78,75,76],[62,14,76,12],[63,12,77,10],[64,12,78,10],[65,8,79,6],[66,6,80,4],[66,7,80,5],[66,9,80,7],[66,13,80,11],[66,14,80,12],[67,4,81,2],[67,5,81,3],[68,4,83,2,"frame"],[68,9,83,7],[68,11,83,9],[68,20,83,9,"frame"],[68,21,83,18,"buffer"],[68,27,83,24],[68,29,83,26],[69,6,84,4],[69,10,84,8],[69,14,84,12],[69,15,84,13,"readyState"],[69,25,84,23],[69,30,84,28],[69,31,84,29],[69,33,84,31],[69,40,84,38],[69,44,84,42],[69,45,84,43,"_queue"],[69,51,84,49],[69,52,84,50],[69,53,84,51,"buffer"],[69,59,84,57],[69,60,84,58],[69,61,84,59],[70,6,85,4],[70,10,85,8],[70,14,85,12],[70,15,85,13,"readyState"],[70,25,85,23],[70,28,85,26],[70,29,85,27],[70,31,85,29],[70,38,85,36],[70,43,85,41],[71,6,87,4],[71,10,87,8],[71,17,87,15,"buffer"],[71,23,87,21],[71,28,87,26],[71,36,87,34],[71,38,87,36,"buffer"],[71,44,87,42],[71,47,87,45,"buffer"],[71,53,87,51],[71,54,87,52,"toString"],[71,62,87,60],[71,63,87,61],[71,64,87,62],[72,6,89,4],[72,10,89,8,"length"],[72,16,89,14],[72,19,89,17,"Buffer"],[72,25,89,23],[72,26,89,24,"byteLength"],[72,36,89,34],[72,37,89,35,"buffer"],[72,43,89,41],[72,44,89,42],[73,8,90,8,"frame"],[73,13,90,13],[73,16,90,17,"Buffer"],[73,22,90,23],[73,23,90,24,"allocUnsafe"],[73,34,90,35],[73,35,90,36,"length"],[73,41,90,42],[73,44,90,45],[73,45,90,46],[73,46,90,47],[74,6,92,4,"frame"],[74,11,92,9],[74,12,92,10],[74,13,92,11],[74,14,92,12],[74,17,92,15],[74,21,92,19],[75,6,93,4,"frame"],[75,11,93,9],[75,12,93,10,"write"],[75,17,93,15],[75,18,93,16,"buffer"],[75,24,93,22],[75,26,93,24],[75,27,93,25],[75,28,93,26],[76,6,94,4,"frame"],[76,11,94,9],[76,12,94,10,"frame"],[76,17,94,15],[76,18,94,16,"length"],[76,24,94,22],[76,27,94,25],[76,28,94,26],[76,29,94,27],[76,32,94,30],[76,36,94,34],[77,6,96,4],[77,10,96,8],[77,11,96,9,"_write"],[77,17,96,15],[77,18,96,16,"frame"],[77,23,96,21],[77,24,96,22],[78,6,97,4],[78,13,97,11],[78,17,97,15],[79,4,98,2],[79,5,98,3],[80,4,100,2,"_handshakeResponse"],[80,22,100,20],[80,24,100,22],[80,33,100,22,"_handshakeResponse"],[80,34,100,22],[80,36,100,33],[81,6,101,4],[81,10,101,8,"start"],[81,15,101,13],[81,18,101,18],[81,62,101,62],[82,8,102,8,"headers"],[82,15,102,15],[82,18,102,18],[82,19,102,19,"start"],[82,24,102,24],[82,26,102,26],[82,30,102,30],[82,31,102,31,"_headers"],[82,39,102,39],[82,40,102,40,"toString"],[82,48,102,48],[82,49,102,49],[82,50,102,50],[82,52,102,52],[82,54,102,54],[82,55,102,55],[83,6,104,4],[83,13,104,11,"Buffer"],[83,19,104,17],[83,20,104,18,"from"],[83,24,104,22],[83,25,104,23,"headers"],[83,32,104,30],[83,33,104,31,"join"],[83,37,104,35],[83,38,104,36],[83,44,104,42],[83,45,104,43],[83,47,104,45],[83,53,104,51],[83,54,104,52],[84,4,105,2],[84,5,105,3],[85,4,107,2,"_parseLeadingByte"],[85,21,107,19],[85,23,107,21],[85,32,107,21,"_parseLeadingByte"],[85,33,107,30,"octet"],[85,38,107,35],[85,40,107,37],[86,6,108,4],[86,10,108,8],[86,11,108,9,"octet"],[86,16,108,14],[86,19,108,17],[86,23,108,21],[86,29,108,27],[86,33,108,31],[86,35,108,33],[87,8,109,6],[87,12,109,10],[87,13,109,11,"_length"],[87,20,109,18],[87,23,109,21],[87,24,109,22],[88,8,110,6],[88,12,110,10],[88,13,110,11,"_stage"],[88,19,110,17],[88,22,110,21],[88,23,110,22],[89,6,111,4],[89,7,111,5],[89,13,111,11],[90,8,112,6],[90,15,112,13],[90,19,112,17],[90,20,112,18,"_length"],[90,27,112,25],[91,8,113,6],[91,15,113,13],[91,19,113,17],[91,20,113,18,"_skipped"],[91,28,113,26],[92,8,114,6],[92,12,114,10],[92,13,114,11,"_buffer"],[92,20,114,18],[92,23,114,21],[92,25,114,23],[93,8,115,6],[93,12,115,10],[93,13,115,11,"_stage"],[93,19,115,17],[93,22,115,21],[93,23,115,22],[94,6,116,4],[95,4,117,2],[96,2,118,0],[96,3,118,1],[97,2,120,0],[97,7,120,5],[97,11,120,9,"key"],[97,14,120,12],[97,18,120,16,"instance"],[97,26,120,24],[97,28,121,2,"Draft75"],[97,35,121,9],[97,36,121,10,"prototype"],[97,45,121,19],[97,46,121,20,"key"],[97,49,121,23],[97,50,121,24],[97,53,121,27,"instance"],[97,61,121,35],[97,62,121,36,"key"],[97,65,121,39],[97,66,121,40],[98,2,123,0,"module"],[98,8,123,6],[98,9,123,7,"exports"],[98,16,123,14],[98,19,123,17,"Draft75"],[98,26,123,24],[99,0,123,25],[99,3]],"functionMap":{"names":["<global>","Draft75","instance.close","instance.parse","_reader.eachByte$argument_0","instance.frame","instance._handshakeResponse","instance._parseLeadingByte"],"mappings":"AAA;cCM;CDS;SEI;GFK;SGE;0BCK;KDgD;GHC;SKE;GLe;sBME;GNK;qBOE;GPU"},"hasCjsExports":true},"type":"js/module"}]}