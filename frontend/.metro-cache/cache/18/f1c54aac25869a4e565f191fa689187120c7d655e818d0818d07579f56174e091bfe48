{"dependencies":[{"name":"util","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":3,"column":13,"index":28},"end":{"line":3,"column":28,"index":43}}],"key":"plO20G0zye191TqKMAMeOagk9EI=","exportNames":["*"],"imports":1}},{"name":"net","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":13,"index":58},"end":{"line":4,"column":27,"index":72}}],"key":"VaJ41XPkzAfy8SiomkwZkgq4Twc=","exportNames":["*"],"imports":1}},{"name":"tls","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":13,"index":87},"end":{"line":5,"column":27,"index":101}}],"key":"eX6GUrFMErTifXO1FtYN6E9FYTs=","exportNames":["*"],"imports":1}},{"name":"url","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":13,"index":116},"end":{"line":6,"column":27,"index":130}}],"key":"Ug/DVHoj+F8BpIFoKWnZvPrb/TI=","exportNames":["*"],"imports":1}},{"name":"websocket-driver","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":13,"index":145},"end":{"line":7,"column":40,"index":172}}],"key":"Cj2ni/iUrqCVJoi2pP++qMSV158=","exportNames":["*"],"imports":1}},{"name":"./api","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":13,"index":187},"end":{"line":8,"column":29,"index":203}}],"key":"gR+OLYNEYAFJQY/iXy79rrSgjmk=","exportNames":["*"],"imports":1}},{"name":"./api/event","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":9,"column":13,"index":218},"end":{"line":9,"column":35,"index":240}}],"key":"n6r1pTXEnKZyJXbcnLtWymfLel0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var util = require(_dependencyMap[0], \"util\"),\n    net = require(_dependencyMap[1], \"net\"),\n    tls = require(_dependencyMap[2], \"tls\"),\n    url = require(_dependencyMap[3], \"url\"),\n    driver = require(_dependencyMap[4], \"websocket-driver\"),\n    API = require(_dependencyMap[5], \"./api\"),\n    Event = require(_dependencyMap[6], \"./api/event\");\n  var DEFAULT_PORTS = {\n      'http:': 80,\n      'https:': 443,\n      'ws:': 80,\n      'wss:': 443\n    },\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n  var Client = function (_url, protocols, options) {\n    options = options || {};\n    this.url = _url;\n    this._driver = driver.client(this.url, {\n      maxLength: options.maxLength,\n      protocols: protocols\n    });\n    ['open', 'error'].forEach(function (event) {\n      this._driver.on(event, function () {\n        self.headers = self._driver.headers;\n        self.statusCode = self._driver.statusCode;\n      });\n    }, this);\n    var proxy = options.proxy || {},\n      endpoint = url.parse(proxy.origin || this.url),\n      port = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect = function () {\n        self._onConnect();\n      },\n      netOptions = options.net || {},\n      originTLS = options.tls || {},\n      socketTLS = proxy.origin ? proxy.tls || {} : originTLS,\n      self = this;\n    netOptions.host = socketTLS.host = endpoint.hostname;\n    netOptions.port = socketTLS.port = port;\n    originTLS.ca = originTLS.ca || options.ca;\n    socketTLS.servername = socketTLS.servername || endpoint.hostname;\n    this._stream = secure ? tls.connect(socketTLS, onConnect) : net.connect(netOptions, onConnect);\n    if (proxy.origin) this._configureProxy(proxy, originTLS);\n    API.call(this, options);\n  };\n  util.inherits(Client, API);\n  Client.prototype._onConnect = function () {\n    var worker = this._proxy || this._driver;\n    worker.start();\n  };\n  Client.prototype._configureProxy = function (proxy, originTLS) {\n    var uri = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self = this,\n      name;\n    this._proxy = this._driver.proxy(proxy.origin);\n    if (proxy.headers) {\n      for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n    }\n    this._proxy.pipe(this._stream, {\n      end: false\n    });\n    this._stream.pipe(this._proxy);\n    this._proxy.on('connect', function () {\n      if (secure) {\n        var options = {\n          socket: self._stream,\n          servername: uri.hostname\n        };\n        for (name in originTLS) options[name] = originTLS[name];\n        self._stream = tls.connect(options);\n        self._configureStream();\n      }\n      self._driver.io.pipe(self._stream);\n      self._stream.pipe(self._driver.io);\n      self._driver.start();\n    });\n    this._proxy.on('error', function (error) {\n      self._driver.emit('error', error);\n    });\n  };\n  module.exports = Client;\n});","lineCount":87,"map":[[2,2,1,0],[2,14,1,12],[4,2,3,0],[4,6,3,4,"util"],[4,10,3,8],[4,13,3,13,"require"],[4,20,3,20],[4,21,3,20,"_dependencyMap"],[4,35,3,20],[4,46,3,27],[4,47,3,28],[5,4,4,4,"net"],[5,7,4,7],[5,10,4,13,"require"],[5,17,4,20],[5,18,4,20,"_dependencyMap"],[5,32,4,20],[5,42,4,26],[5,43,4,27],[6,4,5,4,"tls"],[6,7,5,7],[6,10,5,13,"require"],[6,17,5,20],[6,18,5,20,"_dependencyMap"],[6,32,5,20],[6,42,5,26],[6,43,5,27],[7,4,6,4,"url"],[7,7,6,7],[7,10,6,13,"require"],[7,17,6,20],[7,18,6,20,"_dependencyMap"],[7,32,6,20],[7,42,6,26],[7,43,6,27],[8,4,7,4,"driver"],[8,10,7,10],[8,13,7,13,"require"],[8,20,7,20],[8,21,7,20,"_dependencyMap"],[8,35,7,20],[8,58,7,39],[8,59,7,40],[9,4,8,4,"API"],[9,7,8,7],[9,10,8,13,"require"],[9,17,8,20],[9,18,8,20,"_dependencyMap"],[9,32,8,20],[9,44,8,28],[9,45,8,29],[10,4,9,4,"Event"],[10,9,9,9],[10,12,9,13,"require"],[10,19,9,20],[10,20,9,20,"_dependencyMap"],[10,34,9,20],[10,52,9,34],[10,53,9,35],[11,2,11,0],[11,6,11,4,"DEFAULT_PORTS"],[11,19,11,17],[11,22,11,23],[12,6,11,25],[12,13,11,32],[12,15,11,34],[12,17,11,36],[13,6,11,38],[13,14,11,46],[13,16,11,48],[13,19,11,51],[14,6,11,53],[14,11,11,58],[14,13,11,59],[14,15,11,61],[15,6,11,63],[15,12,11,69],[15,14,11,71],[16,4,11,75],[16,5,11,76],[17,4,12,4,"SECURE_PROTOCOLS"],[17,20,12,20],[17,23,12,23],[17,24,12,24],[17,32,12,32],[17,34,12,34],[17,40,12,40],[17,41,12,41],[18,2,14,0],[18,6,14,4,"Client"],[18,12,14,10],[18,15,14,13],[18,24,14,13,"Client"],[18,25,14,22,"_url"],[18,29,14,26],[18,31,14,28,"protocols"],[18,40,14,37],[18,42,14,39,"options"],[18,49,14,46],[18,51,14,48],[19,4,15,2,"options"],[19,11,15,9],[19,14,15,12,"options"],[19,21,15,19],[19,25,15,23],[19,26,15,24],[19,27,15,25],[20,4,17,2],[20,8,17,6],[20,9,17,7,"url"],[20,12,17,10],[20,15,17,17,"_url"],[20,19,17,21],[21,4,18,2],[21,8,18,6],[21,9,18,7,"_driver"],[21,16,18,14],[21,19,18,17,"driver"],[21,25,18,23],[21,26,18,24,"client"],[21,32,18,30],[21,33,18,31],[21,37,18,35],[21,38,18,36,"url"],[21,41,18,39],[21,43,18,41],[22,6,18,43,"maxLength"],[22,15,18,52],[22,17,18,54,"options"],[22,24,18,61],[22,25,18,62,"maxLength"],[22,34,18,71],[23,6,18,73,"protocols"],[23,15,18,82],[23,17,18,84,"protocols"],[24,4,18,94],[24,5,18,95],[24,6,18,96],[25,4,20,2],[25,5,20,3],[25,11,20,9],[25,13,20,11],[25,20,20,18],[25,21,20,19],[25,22,20,20,"forEach"],[25,29,20,27],[25,30,20,28],[25,40,20,37,"event"],[25,45,20,42],[25,47,20,44],[26,6,21,4],[26,10,21,8],[26,11,21,9,"_driver"],[26,18,21,16],[26,19,21,17,"on"],[26,21,21,19],[26,22,21,20,"event"],[26,27,21,25],[26,29,21,27],[26,41,21,38],[27,8,22,6,"self"],[27,12,22,10],[27,13,22,11,"headers"],[27,20,22,18],[27,23,22,24,"self"],[27,27,22,28],[27,28,22,29,"_driver"],[27,35,22,36],[27,36,22,37,"headers"],[27,43,22,44],[28,8,23,6,"self"],[28,12,23,10],[28,13,23,11,"statusCode"],[28,23,23,21],[28,26,23,24,"self"],[28,30,23,28],[28,31,23,29,"_driver"],[28,38,23,36],[28,39,23,37,"statusCode"],[28,49,23,47],[29,6,24,4],[29,7,24,5],[29,8,24,6],[30,4,25,2],[30,5,25,3],[30,7,25,5],[30,11,25,9],[30,12,25,10],[31,4,27,2],[31,8,27,6,"proxy"],[31,13,27,11],[31,16,27,19,"options"],[31,23,27,26],[31,24,27,27,"proxy"],[31,29,27,32],[31,33,27,36],[31,34,27,37],[31,35,27,38],[32,6,28,6,"endpoint"],[32,14,28,14],[32,17,28,19,"url"],[32,20,28,22],[32,21,28,23,"parse"],[32,26,28,28],[32,27,28,29,"proxy"],[32,32,28,34],[32,33,28,35,"origin"],[32,39,28,41],[32,43,28,45],[32,47,28,49],[32,48,28,50,"url"],[32,51,28,53],[32,52,28,54],[33,6,29,6,"port"],[33,10,29,10],[33,13,29,19,"endpoint"],[33,21,29,27],[33,22,29,28,"port"],[33,26,29,32],[33,30,29,36,"DEFAULT_PORTS"],[33,43,29,49],[33,44,29,50,"endpoint"],[33,52,29,58],[33,53,29,59,"protocol"],[33,61,29,67],[33,62,29,68],[34,6,30,6,"secure"],[34,12,30,12],[34,15,30,19,"SECURE_PROTOCOLS"],[34,31,30,35],[34,32,30,36,"indexOf"],[34,39,30,43],[34,40,30,44,"endpoint"],[34,48,30,52],[34,49,30,53,"protocol"],[34,57,30,61],[34,58,30,62],[34,62,30,66],[34,63,30,67],[35,6,31,6,"onConnect"],[35,15,31,15],[35,18,31,19],[35,27,31,19,"onConnect"],[35,28,31,19],[35,30,31,30],[36,8,31,32,"self"],[36,12,31,36],[36,13,31,37,"_onConnect"],[36,23,31,47],[36,24,31,48],[36,25,31,49],[37,6,31,50],[37,7,31,51],[38,6,32,6,"netOptions"],[38,16,32,16],[38,19,32,19,"options"],[38,26,32,26],[38,27,32,27,"net"],[38,30,32,30],[38,34,32,34],[38,35,32,35],[38,36,32,36],[39,6,33,6,"originTLS"],[39,15,33,15],[39,18,33,19,"options"],[39,25,33,26],[39,26,33,27,"tls"],[39,29,33,30],[39,33,33,34],[39,34,33,35],[39,35,33,36],[40,6,34,6,"socketTLS"],[40,15,34,15],[40,18,34,19,"proxy"],[40,23,34,24],[40,24,34,25,"origin"],[40,30,34,31],[40,33,34,35,"proxy"],[40,38,34,40],[40,39,34,41,"tls"],[40,42,34,44],[40,46,34,48],[40,47,34,49],[40,48,34,50],[40,51,34,54,"originTLS"],[40,60,34,63],[41,6,35,6,"self"],[41,10,35,10],[41,13,35,19],[41,17,35,23],[42,4,37,2,"netOptions"],[42,14,37,12],[42,15,37,13,"host"],[42,19,37,17],[42,22,37,20,"socketTLS"],[42,31,37,29],[42,32,37,30,"host"],[42,36,37,34],[42,39,37,37,"endpoint"],[42,47,37,45],[42,48,37,46,"hostname"],[42,56,37,54],[43,4,38,2,"netOptions"],[43,14,38,12],[43,15,38,13,"port"],[43,19,38,17],[43,22,38,20,"socketTLS"],[43,31,38,29],[43,32,38,30,"port"],[43,36,38,34],[43,39,38,37,"port"],[43,43,38,41],[44,4,40,2,"originTLS"],[44,13,40,11],[44,14,40,12,"ca"],[44,16,40,14],[44,19,40,17,"originTLS"],[44,28,40,26],[44,29,40,27,"ca"],[44,31,40,29],[44,35,40,33,"options"],[44,42,40,40],[44,43,40,41,"ca"],[44,45,40,43],[45,4,41,2,"socketTLS"],[45,13,41,11],[45,14,41,12,"servername"],[45,24,41,22],[45,27,41,25,"socketTLS"],[45,36,41,34],[45,37,41,35,"servername"],[45,47,41,45],[45,51,41,49,"endpoint"],[45,59,41,57],[45,60,41,58,"hostname"],[45,68,41,66],[46,4,43,2],[46,8,43,6],[46,9,43,7,"_stream"],[46,16,43,14],[46,19,43,17,"secure"],[46,25,43,23],[46,28,44,17,"tls"],[46,31,44,20],[46,32,44,21,"connect"],[46,39,44,28],[46,40,44,29,"socketTLS"],[46,49,44,38],[46,51,44,40,"onConnect"],[46,60,44,49],[46,61,44,50],[46,64,45,17,"net"],[46,67,45,20],[46,68,45,21,"connect"],[46,75,45,28],[46,76,45,29,"netOptions"],[46,86,45,39],[46,88,45,41,"onConnect"],[46,97,45,50],[46,98,45,51],[47,4,47,2],[47,8,47,6,"proxy"],[47,13,47,11],[47,14,47,12,"origin"],[47,20,47,18],[47,22,47,20],[47,26,47,24],[47,27,47,25,"_configureProxy"],[47,42,47,40],[47,43,47,41,"proxy"],[47,48,47,46],[47,50,47,48,"originTLS"],[47,59,47,57],[47,60,47,58],[48,4,49,2,"API"],[48,7,49,5],[48,8,49,6,"call"],[48,12,49,10],[48,13,49,11],[48,17,49,15],[48,19,49,17,"options"],[48,26,49,24],[48,27,49,25],[49,2,50,0],[49,3,50,1],[50,2,51,0,"util"],[50,6,51,4],[50,7,51,5,"inherits"],[50,15,51,13],[50,16,51,14,"Client"],[50,22,51,20],[50,24,51,22,"API"],[50,27,51,25],[50,28,51,26],[51,2,53,0,"Client"],[51,8,53,6],[51,9,53,7,"prototype"],[51,18,53,16],[51,19,53,17,"_onConnect"],[51,29,53,27],[51,32,53,30],[51,44,53,41],[52,4,54,2],[52,8,54,6,"worker"],[52,14,54,12],[52,17,54,15],[52,21,54,19],[52,22,54,20,"_proxy"],[52,28,54,26],[52,32,54,30],[52,36,54,34],[52,37,54,35,"_driver"],[52,44,54,42],[53,4,55,2,"worker"],[53,10,55,8],[53,11,55,9,"start"],[53,16,55,14],[53,17,55,15],[53,18,55,16],[54,2,56,0],[54,3,56,1],[55,2,58,0,"Client"],[55,8,58,6],[55,9,58,7,"prototype"],[55,18,58,16],[55,19,58,17,"_configureProxy"],[55,34,58,32],[55,37,58,35],[55,47,58,44,"proxy"],[55,52,58,49],[55,54,58,51,"originTLS"],[55,63,58,60],[55,65,58,62],[56,4,59,2],[56,8,59,6,"uri"],[56,11,59,9],[56,14,59,15,"url"],[56,17,59,18],[56,18,59,19,"parse"],[56,23,59,24],[56,24,59,25],[56,28,59,29],[56,29,59,30,"url"],[56,32,59,33],[56,33,59,34],[57,6,60,6,"secure"],[57,12,60,12],[57,15,60,15,"SECURE_PROTOCOLS"],[57,31,60,31],[57,32,60,32,"indexOf"],[57,39,60,39],[57,40,60,40,"uri"],[57,43,60,43],[57,44,60,44,"protocol"],[57,52,60,52],[57,53,60,53],[57,57,60,57],[57,58,60,58],[58,6,61,6,"self"],[58,10,61,10],[58,13,61,15],[58,17,61,19],[59,6,62,6,"name"],[59,10,62,10],[60,4,64,2],[60,8,64,6],[60,9,64,7,"_proxy"],[60,15,64,13],[60,18,64,16],[60,22,64,20],[60,23,64,21,"_driver"],[60,30,64,28],[60,31,64,29,"proxy"],[60,36,64,34],[60,37,64,35,"proxy"],[60,42,64,40],[60,43,64,41,"origin"],[60,49,64,47],[60,50,64,48],[61,4,66,2],[61,8,66,6,"proxy"],[61,13,66,11],[61,14,66,12,"headers"],[61,21,66,19],[61,23,66,21],[62,6,67,4],[62,11,67,9,"name"],[62,15,67,13],[62,19,67,17,"proxy"],[62,24,67,22],[62,25,67,23,"headers"],[62,32,67,30],[62,34,67,32],[62,38,67,36],[62,39,67,37,"_proxy"],[62,45,67,43],[62,46,67,44,"setHeader"],[62,55,67,53],[62,56,67,54,"name"],[62,60,67,58],[62,62,67,60,"proxy"],[62,67,67,65],[62,68,67,66,"headers"],[62,75,67,73],[62,76,67,74,"name"],[62,80,67,78],[62,81,67,79],[62,82,67,80],[63,4,68,2],[64,4,70,2],[64,8,70,6],[64,9,70,7,"_proxy"],[64,15,70,13],[64,16,70,14,"pipe"],[64,20,70,18],[64,21,70,19],[64,25,70,23],[64,26,70,24,"_stream"],[64,33,70,31],[64,35,70,33],[65,6,70,35,"end"],[65,9,70,38],[65,11,70,40],[66,4,70,46],[66,5,70,47],[66,6,70,48],[67,4,71,2],[67,8,71,6],[67,9,71,7,"_stream"],[67,16,71,14],[67,17,71,15,"pipe"],[67,21,71,19],[67,22,71,20],[67,26,71,24],[67,27,71,25,"_proxy"],[67,33,71,31],[67,34,71,32],[68,4,73,2],[68,8,73,6],[68,9,73,7,"_proxy"],[68,15,73,13],[68,16,73,14,"on"],[68,18,73,16],[68,19,73,17],[68,28,73,26],[68,30,73,28],[68,42,73,39],[69,6,74,4],[69,10,74,8,"secure"],[69,16,74,14],[69,18,74,16],[70,8,75,6],[70,12,75,10,"options"],[70,19,75,17],[70,22,75,20],[71,10,75,22,"socket"],[71,16,75,28],[71,18,75,30,"self"],[71,22,75,34],[71,23,75,35,"_stream"],[71,30,75,42],[72,10,75,44,"servername"],[72,20,75,54],[72,22,75,56,"uri"],[72,25,75,59],[72,26,75,60,"hostname"],[73,8,75,69],[73,9,75,70],[74,8,76,6],[74,13,76,11,"name"],[74,17,76,15],[74,21,76,19,"originTLS"],[74,30,76,28],[74,32,76,30,"options"],[74,39,76,37],[74,40,76,38,"name"],[74,44,76,42],[74,45,76,43],[74,48,76,46,"originTLS"],[74,57,76,55],[74,58,76,56,"name"],[74,62,76,60],[74,63,76,61],[75,8,77,6,"self"],[75,12,77,10],[75,13,77,11,"_stream"],[75,20,77,18],[75,23,77,21,"tls"],[75,26,77,24],[75,27,77,25,"connect"],[75,34,77,32],[75,35,77,33,"options"],[75,42,77,40],[75,43,77,41],[76,8,78,6,"self"],[76,12,78,10],[76,13,78,11,"_configureStream"],[76,29,78,27],[76,30,78,28],[76,31,78,29],[77,6,79,4],[78,6,80,4,"self"],[78,10,80,8],[78,11,80,9,"_driver"],[78,18,80,16],[78,19,80,17,"io"],[78,21,80,19],[78,22,80,20,"pipe"],[78,26,80,24],[78,27,80,25,"self"],[78,31,80,29],[78,32,80,30,"_stream"],[78,39,80,37],[78,40,80,38],[79,6,81,4,"self"],[79,10,81,8],[79,11,81,9,"_stream"],[79,18,81,16],[79,19,81,17,"pipe"],[79,23,81,21],[79,24,81,22,"self"],[79,28,81,26],[79,29,81,27,"_driver"],[79,36,81,34],[79,37,81,35,"io"],[79,39,81,37],[79,40,81,38],[80,6,82,4,"self"],[80,10,82,8],[80,11,82,9,"_driver"],[80,18,82,16],[80,19,82,17,"start"],[80,24,82,22],[80,25,82,23],[80,26,82,24],[81,4,83,2],[81,5,83,3],[81,6,83,4],[82,4,85,2],[82,8,85,6],[82,9,85,7,"_proxy"],[82,15,85,13],[82,16,85,14,"on"],[82,18,85,16],[82,19,85,17],[82,26,85,24],[82,28,85,26],[82,38,85,35,"error"],[82,43,85,40],[82,45,85,42],[83,6,86,4,"self"],[83,10,86,8],[83,11,86,9,"_driver"],[83,18,86,16],[83,19,86,17,"emit"],[83,23,86,21],[83,24,86,22],[83,31,86,29],[83,33,86,31,"error"],[83,38,86,36],[83,39,86,37],[84,4,87,2],[84,5,87,3],[84,6,87,4],[85,2,88,0],[85,3,88,1],[86,2,90,0,"module"],[86,8,90,6],[86,9,90,7,"exports"],[86,16,90,14],[86,19,90,17,"Client"],[86,25,90,23],[87,0,90,24],[87,3]],"functionMap":{"names":["<global>","Client","forEach$argument_0","_driver.on$argument_1","onConnect","Client.prototype._onConnect","Client.prototype._configureProxy","_proxy.on$argument_1"],"mappings":"AAA;aCa;4BCM;2BCC;KDG;GDC;mBGM,gCH;CDmB;8BKG;CLG;mCME;4BCe;GDU;0BCE;GDE;CNC"},"hasCjsExports":true},"type":"js/module"}]}